<?xml version="1.0" encoding="UTF-8"?>

<atlassian-plugin key="${project.groupId}.${project.artifactId}" name="${project.name}" plugins-version="2">
  <plugin-info>
    <description>${project.description}</description>
    <version>${project.version}</version>
    <vendor name="${project.organization.name}" url="${project.organization.url}"/>
    <param name="plugin-icon">images/pluginIcon.png</param>
    <param name="plugin-logo">images/pluginLogo.png</param>
    <!--  bundle-instructions>
      <Import-Package>com.atlassian.stash.ssh,*;resolution:=optional</Import-Package>
    </bundle-instructions-->
  </plugin-info>
  <!-- add our i18n resource -->
  <resource type="i18n" name="i18n" location="stash-ssh-key-enforcer"/>
  <!-- add our web resources -->
  <web-resource key="stash-ssh-key-enforcer-resources" name="stash-ssh-key-enforcer Web Resources">
    <dependency>com.atlassian.auiplugin:ajs</dependency>
    <dependency>com.atlassian.soy.soy-template-plugin:soy-deps</dependency>
    <!-- transform calls to AJS.getText() inside JS files -->
    <transformation extension="js">
      <transformer key="jsI18n"/>
    </transformation>
    <!-- resource type="soy" name="supportTeamTab" location="/override-add-keys.soy"/> -->
    <!-- transform Soy templates into JS -->
    <transformation extension="soy">
      <transformer key="soyTransformer"/>
    </transformation>
    <resource type="download" name="key-enforcer.js" location="/js/stash-ssh-key-enforcer.js"/>
    <context>atl.general</context>
  </web-resource>
  <stash-resource key="account-ssh-soy" name="Account Tab Soy Templates">
    <directory location="/templates/"/>
  </stash-resource>
  <component key="GeneralEventListener" class="com.edwardawebb.stash.GeneralEventListener"/>
  <servlet name="User Key Management Servlet" i18n-name-key="user-key-management-servlet.name" key="user-key-management-servlet" class="com.edwardawebb.servlet.UserKeyManagementServlet">
    <description key="user-key-management-servlet.description">The User Key Management Servlet Plugin</description>
    <url-pattern>/account/users/*</url-pattern>
  </servlet>
  <rest name="Key Details Resource" i18n-name-key="key-details-resource.name" key="key-details-resource" path="/keydetailsresource" version="1.0">
    <description key="key-details-resource.description">The Key Details Resource Plugin</description>
  </rest>
  <web-item key="user-keys" name="User Keys" section="stash.user.account.nav">
    <link>/plugins/servlet/account/users/${accountUser.name}</link>
    <!-- <link>${navBuilder.pluginServlets().path('userkeymanagementservlet').buildRelNoContext()}</link-->
    <label key="key.enforcer.servlet.link.label"/>
  </web-item>
  <!-- import from the product container -->
  <component-import key="applicationProperties" interface="com.atlassian.sal.api.ApplicationProperties"/>
  <component-import key="soyTemplateRenderer" interface="com.atlassian.soy.renderer.SoyTemplateRenderer" filter=""/>
  <component-import key="userManager" interface="com.atlassian.sal.api.user.UserManager" filter=""/>
  <component-import key="sshKeyManager" interface="com.atlassian.stash.ssh.api.SshKeyService" filter=""/>
  <component key="enterpriseSshKeyService" class="com.edwardawebb.stash.ssh.EnterpriseSshKeyServiceImpl" name="Enterprise Ssh Key Manager Impl" i18n-name-key="enterprise-ssh-key-manager-impl.name">
    <description key="enterprise-ssh-key-manager-impl.description">The Enterprise Ssh Key Manager Impl Plugin</description>
    <interface>com.edwardawebb.stash.ssh.EnterpriseSshKeyService</interface>
  </component>
  <component name="Enterprise Key Repository" i18n-name-key="enterprise-key-repository.name" key="enterprise-key-repository" class="com.edwardawebb.stash.ssh.EnterpriseKeyRepositoryImpl">
    <description key="enterprise-key-repository.description">The Enterprise Key Repository Plugin</description>
    <interface>com.edwardawebb.stash.ssh.EnterpriseKeyRepository</interface>
  </component>
  
  
  <!--  AO support for key meta -->
  
  <component-import key="ao" name="Active Objects service" interface="com.atlassian.activeobjects.external.ActiveObjects">
  <description>Component to access Active Objects functionality from the plugin</description>
</component-import>
  <ao key="ao-module">
  <description>The module configuring the Active Objects service used by this plugin</description>
  <entity>com.edwardawebb.stash.ssh.SshKeyEntity</entity>
</ao>
</atlassian-plugin>
